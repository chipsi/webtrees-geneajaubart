CKEDITOR.plugins.add("wordcount",{lang:"ca de en es fr no pl".split(" "),init:function(u){function s(b){return"cke_wordcount_"+b.name}function h(b){var m=0,l=0,k,j;if(j=b.getData()){if(!v.countHTML&&v.showCharCount||v.showWordCount){k=j.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");var c=document.createElement("div");c.innerHTML=k;k=""==c.textContent&&"undefined"==typeof c.innerText?"0":c.textContent||c.innerText}v.showCharCount&&(l=v.countHTML?j.length:k.length);v.showWordCount&&(m=k.split(/\s+/).length)}j=a.replace("%wordCount%",m).replace("%charCount%",l);document.getElementById(s(b)).innerHTML=j;if(l==f){return !0}f=l;v.showWordCount&&m>v.wordLimit?g(u,o):!i&&m<v.wordLimit&&e(u);v.showCharCount&&l>v.charLimit?g(u,o):!i&&l<v.charLimit&&e(u);return !0}function g(d,c){o=!0;i=!1;d.execCommand("undo");c||(document.getElementById(s(d)).className+=" cke_wordcountLimitReached",d.fire("limitReached",{},u));d.config.Locked=1;d.fire("change")}function e(b){i=!0;o=!1;b.config.Locked=0;document.getElementById(s(b)).className="cke_wordcount"}if(u.elementMode!==CKEDITOR.ELEMENT_MODE_INLINE){var t='<span class="cke_path_item">',f=0,o=!1,i=!1,v=CKEDITOR.tools.extend({showWordCount:!0,showCharCount:!1,charLimit:"unlimited",wordLimit:"unlimited",countHTML:!1},u.config.wordcount||{},!0);v.showCharCount&&(t+=u.lang.wordcount[v.countHTML?"CharCountWithHTML":"CharCount"]+"&nbsp;%charCount%","unlimited"!=v.charLimit&&(t+="&nbsp;("+u.lang.wordcount.limit+"&nbsp;"+v.charLimit+")"));v.showCharCount&&v.showWordCount&&(t+=",&nbsp;");v.showWordCount&&(t+=u.lang.wordcount.WordCount+" %wordCount%","unlimited"!=v.wordLimit&&(t+="&nbsp;("+u.lang.wordcount.limit+"&nbsp;"+v.wordLimit+")"));var a=t+"</span>";CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css");u.on("uiSpace",function(b){"bottom"==b.data.space&&(b.data.html+='<div id="'+s(b.editor)+'" class="cke_wordcount" style="" title="'+u.lang.wordcount.title+'">&nbsp;</div>')},u,null,100);u.on("dataReady",function(b){b.editor.getData().length>v.wordLimit&&g(u);h(b.editor)},u,null,100);u.on("key",function(b){h(b.editor)},u,null,100);u.on("afterPaste",function(b){h(b.editor)},u,null,100);u.on("blur",function(){},u,null,300);String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}}});