(function(){CKEDITOR.dialog.add("templates",function(c){function l(j,h){var f=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),b='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';j.image&&h&&(b+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(h+j.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>');b+='<td style="white-space:normal;"><span class="cke_tpl_title">'+j.title+"</span><br/>";j.description&&(b+="<span>"+j.description+"</span>");f.getFirst().setHtml(b+"</td></tr></table>");f.on("click",function(){var k=j.html,m=CKEDITOR.dialog.getCurrent();m.getValueOf("selectTpl","chkInsertOpt")?(c.fire("saveSnapshot"),c.setData(k,function(){m.hide();var n=c.createRange();n.moveToElementEditStart(c.editable());n.select();setTimeout(function(){c.fire("saveSnapshot")},0)})):(c.insertHtml(k),m.hide())});return f}function d(n){var m=n.data.getTarget(),h=g.equals(m);if(h||g.contains(m)){var j=n.data.getKeystroke(),k=g.getElementsByTag("a"),o;if(k){if(h){o=k.getItem(0)}else{switch(j){case 40:o=m.getNext();break;case 38:o=m.getPrevious();break;case 13:case 32:m.fire("click")}}o&&(o.focus(),n.data.preventDefault())}}}var e=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(e.path+"dialogs/templates.css"));var g,e="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),i=c.lang.templates,a=c.config;return{title:c.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:i.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+i.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+e+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+e+'">'+i.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:i.insertOption,"default":a.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var b=this.getContentElement("selectTpl","templatesList");g=b.getElement();CKEDITOR.loadTemplates(a.templates_files,function(){var t=(a.templates||"default").split(",");if(t.length){var r=g;r.setHtml("");for(var u=0,q=t.length;u<q;u++){for(var s=CKEDITOR.getTemplates(t[u]),o=s.imagesPath,s=s.templates,f=s.length,m=0;m<f;m++){var h=l(s[m],o);h.setAttribute("aria-posinset",m+1);h.setAttribute("aria-setsize",f);r.append(h)}}b.focus()}else{g.setHtml('<div class="cke_tpl_empty"><span>'+i.emptyListMsg+"</span></div>")}});this._.element.on("keydown",d)},onHide:function(){this._.element.removeListener("keydown",d)}}})})();