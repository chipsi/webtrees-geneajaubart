(function(){function b(q){q=q.toUpperCase();for(var u=a.length,p=0,r=0;r<u;++r){for(var t=a[r],s=t[1].length;q.substr(0,s)==t[1];q=q.substr(s)){p+=t[0]}}return p}function o(q){q=q.toUpperCase();for(var s=n.length,p=1,r=1;0<q.length;r*=s){p+=n.indexOf(q.charAt(q.length-1))*r,q=q.substr(0,q.length-1)}return p}var f=CKEDITOR.htmlParser.fragment.prototype,c=CKEDITOR.htmlParser.element.prototype;f.onlyChild=c.onlyChild=function(){var p=this.children;return 1==p.length&&p[0]||null};c.removeAnyChildWithName=function(q){for(var t=this.children,p=[],r,s=0;s<t.length;s++){r=t[s],r.name&&(r.name==q&&(p.push(r),t.splice(s--,1)),p=p.concat(r.removeAnyChildWithName(q)))}return p};c.getAncestor=function(p){for(var q=this.parent;q&&(!q.name||!q.name.match(p));){q=q.parent}return q};f.firstChild=c.firstChild=function(q){for(var r,p=0;p<this.children.length;p++){if(r=this.children[p],q(r)||r.name&&(r=r.firstChild(q))){return r}}return null};c.addStyle=function(q,t,p){var r="";if("string"==typeof t){r+=q+":"+t+";"}else{if("object"==typeof q){for(var s in q){q.hasOwnProperty(s)&&(r+=s+":"+q[s]+";")}}else{r+=q}p=t}this.attributes||(this.attributes={});q=this.attributes.style||"";q=(p?[r,q]:[q,r]).join(";");this.attributes.style=q.replace(/^;|;(?=;)/,"")};c.getStyle=function(p){var q=this.attributes.style;if(q){return q=CKEDITOR.tools.parseCssText(q,1),q[p]}};CKEDITOR.dtd.parentOf=function(q){var r={},p;for(p in this){-1==p.indexOf("$")&&this[p][q]&&(r[p]=1)}return r};var h=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,m=/^(?:\b0[^\s]*\s*){1,4}$/,e={ol:{decimal:/\d+/,"lower-roman":/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,"upper-roman":/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},ul:{disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/}},a=[[1000,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",l=0,k=null,g,f=CKEDITOR.plugins,d=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(d);var j=f.pastefromword={utils:{createListBulletMarker:function(q,r){var p=new CKEDITOR.htmlParser.element("cke:listbullet");p.attributes={"cke:listsymbol":q[0]};p.add(new CKEDITOR.htmlParser.text(r));return p},isListBulletIndicator:function(p){if(/mso-list\s*:\s*Ignore/i.test(p.attributes&&p.attributes.style)){return !0}},isContainingOnlySpaces:function(p){var q;return(q=p.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(q.value)},resolveList:function(q){var r=q.attributes,p;if((p=q.removeAnyChildWithName("cke:listbullet"))&&p.length&&(p=p[0])){return q.name="cke:li",r.style&&(r.style=j.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(s){s=s.split(" ");s=CKEDITOR.tools.convertToPx(s[3]||s[1]||s[0]);!l&&null!==k&&s>k&&(l=s-k);k=s;r["cke:indent"]=l&&Math.ceil(s/l)+1||1}],[/^mso-list$/,null,function(t){t=t.split(" ");var s=Number(t[0].match(/\d+/));t=Number(t[1].match(/\d+/));1==t&&(s!==g&&(r["cke:reset"]=1),g=s);r["cke:indent"]=t}]])(r.style,q)||""),r["cke:indent"]||(k=0,r["cke:indent"]=1),CKEDITOR.tools.extend(r,p.attributes),!0}g=k=l=null;return !1},getStyleComponents:function(q,s,p){d.setStyle(q,s);q={};s=p.length;for(var r=0;r<s;r++){q[p[r]]=d.getStyle(p[r])}return q},listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(y,w){w="number"==typeof w?w:1;var x=y.attributes,t;switch(x.type){case"a":t="lower-alpha";break;case"1":t="decimal"}for(var v=y.children,u,r=0;r<v.length;r++){if(u=v[r],u.name in CKEDITOR.dtd.$listItem){var q=u.attributes,s=u.children,p=s[s.length-1];p.name in CKEDITOR.dtd.$list&&(y.add(p,r+1),--s.length||v.splice(r--,1));u.name="cke:li";x.start&&!r&&(q.value=x.start);j.filters.stylesFilter([["tab-stops",null,function(z){(z=z.split(" ")[1].match(h))&&(k=CKEDITOR.tools.convertToPx(z[0]))}],1==w?["mso-list",null,function(z){z=z.split(" ");z=Number(z[0].match(/\d+/));z!==g&&(q["cke:reset"]=1);g=z}]:null])(q.style);q["cke:indent"]=w;q["cke:listtype"]=y.name;q["cke:list-style-type"]=t}else{if(u.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[u,w+1]);v=v.slice(0,r).concat(u.children).concat(v.slice(r+1));y.children=[];u=0;for(s=v.length;u<s;u++){y.add(v[u])}v=y.children}}}delete y.name;x["cke:list"]=1},assembleList:function(L){var J=L.children,K,G,I,H,E,C;L=[];for(var F,z,D,A,B,x,y=0;y<J.length;y++){if(K=J[y],"cke:li"==K.name){if(K.name="li",G=K.attributes,D=(D=G["cke:listsymbol"])&&D.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),A=B=x=null,G["cke:ignored"]){J.splice(y--,1)}else{G["cke:reset"]&&(C=H=E=null);I=Number(G["cke:indent"]);I!=H&&(z=F=null);if(D){if(z&&e[z][F].test(D[1])){A=z,B=F}else{for(var v in e){for(var q in e[v]){if(e[v][q].test(D[1])){if("ol"==v&&/alpha|roman/.test(q)){if(F=/roman/.test(q)?b(D[1]):o(D[1]),!x||F<x){x=F,A=v,B=q}}else{A=v;B=q;break}}}}}!A&&(A=D[2]?"ol":"ul")}else{A=G["cke:listtype"]||"ol",B=G["cke:list-style-type"]}z=A;F=B||("ol"==A?"decimal":"disc");B&&B!=("ol"==A?"decimal":"disc")&&K.addStyle("list-style-type",B);if("ol"==A&&D){switch(B){case"decimal":x=Number(D[1]);break;case"lower-roman":case"upper-roman":x=b(D[1]);break;case"lower-alpha":case"upper-alpha":x=o(D[1])}K.attributes.value=x}if(C){if(I>H){L.push(C=new CKEDITOR.htmlParser.element(A)),C.add(K),E.add(C)}else{if(I<H){H-=I;for(var u;H--&&(u=C.parent);){C=u.parent}}C.add(K)}J.splice(y--,1)}else{L.push(C=new CKEDITOR.htmlParser.element(A)),C.add(K),J[y]=C}E=K;H=I}}else{C&&(C=H=E=null)}}for(y=0;y<L.length;y++){if(C=L[y],v=C.children,F=F=void 0,q=C.children.length,u=F=void 0,J=/list-style-type:(.*?)(?:;|$)/,H=CKEDITOR.plugins.pastefromword.filters.stylesFilter,F=C.attributes,!J.exec(F.style)){for(E=0;E<q;E++){if(F=v[E],F.attributes.value&&Number(F.attributes.value)==E+1&&delete F.attributes.value,F=J.exec(F.attributes.style)){if(F[1]==u||!u){u=F[1]}else{u=null;break}}}if(u){for(E=0;E<q;E++){F=v[E].attributes,F.style&&(F.style=H([["list-style-type"]])(F.style)||"")}C.addStyle("list-style-type",u)}}}g=k=l=null},falsyFilter:function(){return !1},stylesFilter:function(p,q){return function(r,s){var u=[];(r||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(w,A,z){A=A.toLowerCase();"font-family"==A&&(z=z.replace(/["']/g,""));for(var B,y,v,x=0;x<p.length;x++){if(p[x]&&(w=p[x][0],B=p[x][1],y=p[x][2],v=p[x][3],A.match(w)&&(!B||z.match(B)))){A=v||A;q&&(y=y||z);"function"==typeof y&&(y=y(z,s,A));y&&y.push&&(A=y[0],y=y[1]);"string"==typeof y&&u.push([A,y]);return}}!q&&u.push([A,z])});for(var t=0;t<u.length;t++){u[t]=u[t].join(":")}return u.length?u.join(";")+";":!1}},elementMigrateFilter:function(p,q){return p?function(r){var s=q?(new CKEDITOR.style(p,q))._.definition:p;r.name=s.element;CKEDITOR.tools.extend(r.attributes,CKEDITOR.tools.clone(s.attributes));r.addStyle(CKEDITOR.style.getStyleText(s))}:function(){}},styleMigrateFilter:function(q,r){var p=this.elementMigrateFilter;return q?function(t,v){var u=new CKEDITOR.htmlParser.element(null),s={};s[r]=t;p(q,s)(u);u.children=v.children;v.children=[u];u.filter=function(){};u.parent=v}:function(){}},bogusAttrFilter:function(p,q){if(-1==q.name.indexOf("cke:")){return !1}},applyStyleFilter:null},getRules:function(R,P){var Q=CKEDITOR.dtd,M=CKEDITOR.tools.extend({},Q.$block,Q.$listItem,Q.$tableContent),O=R.config,N=this.filters,K=N.falsyFilter,I=N.stylesFilter,L=N.elementMigrateFilter,F=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),J=this.utils.createListBulletMarker,G=N.flattenList,H=N.assembleList,C=this.utils.isListBulletIndicator,E=this.utils.isContainingOnlySpaces,B=this.utils.resolveList,x=function(p){p=CKEDITOR.tools.convertToPx(p);return isNaN(p)?p:p+"px"},A=this.utils.getStyleComponents,y=this.utils.listDtdParents,D=!1!==O.pasteFromWordRemoveFontStyles,z=!1!==O.pasteFromWordRemoveStyles;return{elementNames:[[/meta|link|script/,""]],root:function(p){p.filterChildren(P);H(p)},elements:{"^":function(p){var q;CKEDITOR.env.gecko&&(q=N.applyStyleFilter)&&q(p)},$:function(q){var p=q.name||"",r=q.attributes;p in M&&r.style&&(r.style=I([[/^(:?width|height)$/,null,x]])(r.style)||"");if(p.match(/h\d/)){q.filterChildren(P);if(B(q)){return}L(O["format_"+p])(q)}else{if(p in Q.$inline){q.filterChildren(P),E(q)&&delete q.name}else{if(-1!=p.indexOf(":")&&-1==p.indexOf("cke")){q.filterChildren(P);if("v:imagedata"==p){if(p=q.attributes["o:href"]){q.attributes.src=p}q.name="img";return}delete q.name}}}p in y&&(q.filterChildren(P),H(q))},style:function(p){if(CKEDITOR.env.gecko){p=(p=p.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/))&&p[1];var q={};p&&(p.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(s,r,t){r=r.split(",");s=r.length;for(var u=0;u<s;u++){CKEDITOR.tools.trim(r[u]).replace(/^(\w+)(\.[\w-]+)?$/g,function(w,v,S){v=v||"*";S=S.substring(1,S.length);S.match(/MsoNormal/)||(q[v]||(q[v]={}),S?q[v][S]=t:q[v]=t)})}}),N.applyStyleFilter=function(s){var r=q["*"]?"*":s.name,t=s.attributes&&s.attributes["class"];r in q&&(r=q[r],"object"==typeof r&&(r=r[t]),r&&s.addStyle(r,!0))})}return !1},p:function(q){if(/MsoListParagraph/i.exec(q.attributes["class"])||q.getStyle("mso-list")){var p=q.firstChild(function(r){return r.type==CKEDITOR.NODE_TEXT&&!E(r.parent)});(p=p&&p.parent)&&p.addStyle("mso-list","Ignore")}q.filterChildren(P);B(q)||(O.enterMode==CKEDITOR.ENTER_BR?(delete q.name,q.add(new CKEDITOR.htmlParser.element("br"))):L(O["format_"+(O.enterMode==CKEDITOR.ENTER_P?"p":"div")])(q))},div:function(q){var r=q.onlyChild();if(r&&"table"==r.name){var p=q.attributes;r.attributes=CKEDITOR.tools.extend(r.attributes,p);p.style&&r.addStyle(p.style);r=new CKEDITOR.htmlParser.element("div");r.addStyle("clear","both");q.add(r);delete q.name}},td:function(p){p.getAncestor("thead")&&(p.name="th")},ol:G,ul:G,dl:G,font:function(q){if(C(q.parent)){delete q.name}else{q.filterChildren(P);var p=q.attributes,s=p.style,r=q.parent;"font"==r.name?(CKEDITOR.tools.extend(r.attributes,q.attributes),s&&r.addStyle(s),delete q.name):(s=s||"",p.color&&("#000000"!=p.color&&(s+="color:"+p.color+";"),delete p.color),p.face&&(s+="font-family:"+p.face+";",delete p.face),p.size&&(s+="font-size:"+(3<p.size?"large":3>p.size?"small":"medium")+";",delete p.size),q.name="span",q.addStyle(s))}},span:function(q){if(C(q.parent)){return !1}q.filterChildren(P);if(E(q)){return delete q.name,null}if(C(q)){var p=q.firstChild(function(s){return s.value||"img"==s.name}),r=(p=p&&(p.value||"l."))&&p.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(r){return p=J(r,p),(q=q.getAncestor("span"))&&/ mso-hide:\s*all|display:\s*none /.test(q.attributes.style)&&(p.attributes["cke:ignored"]=1),p}}if(r=(p=q.attributes)&&p.style){p.style=I([["line-height"],[/^font-family$/,null,!D?F(O.font_style,"family"):null],[/^font-size$/,null,!D?F(O.fontSize_style,"size"):null],[/^color$/,null,!D?F(O.colorButton_foreStyle,"color"):null],[/^background-color$/,null,!D?F(O.colorButton_backStyle,"color"):null]])(r,q)||""}p.style||delete p.style;CKEDITOR.tools.isEmpty(p)&&delete q.name;return null},b:L(O.coreStyles_bold),i:L(O.coreStyles_italic),u:L(O.coreStyles_underline),s:L(O.coreStyles_strike),sup:L(O.coreStyles_superscript),sub:L(O.coreStyles_subscript),a:function(p){p=p.attributes;p.href&&p.href.match(/^file:\/\/\/[\S]+#/i)&&(p.href=p.href.replace(/^file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(p){p.getAncestor(/h\d/)&&!O.pasteFromWordNumberedHeadingToList&&delete p.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:I(z?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(q,p,r){if(p.name in {p:1,div:1}){p="ltr"==O.contentsLangDirection?"margin-left":"margin-right";if("margin"==r){q=A(r,q,[p])[p]}else{if(r!=p){return null}}if(q&&!m.test(q)){return[p,q]}}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(q,p){if("img"==p.name){return q}}],[/^width|height$/,null,function(q,p){if(p.name in {table:1,td:1,th:1,img:1}){return q}}]]:[[/^mso-/],[/-color$/,null,function(p){if("transparent"==p){return !1}if(CKEDITOR.env.gecko){return p.replace(/-moz-use-text-color/g,"transparent")}}],[/^margin$/,m],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],D?[/font-?/]:null],z),width:function(p,q){if(q.name in Q.$tableContent){return !1}},border:function(p,q){if(q.name in Q.$tableContent){return !1}},"class":K,bgcolor:K,valign:z?K:function(q,p){p.addStyle("vertical-align",q);return !1}},comment:!CKEDITOR.env.ie?function(q,p){var s=q.match(/<img.*?>/),r=q.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);return r?(r=(s=r[1]||s&&"l.")&&s.match(/>(?:[(]?)([^\s]+?)([.)]?)</),J(r,s)):CKEDITOR.env.gecko&&s?(s=CKEDITOR.htmlParser.fragment.fromHtml(s[0]).children[0],(r=(r=(r=p.previous)&&r.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&r[1])&&(s.attributes.src=r),s):!1}:K}}},i=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};i.prototype={toHtml:function(p){p=CKEDITOR.htmlParser.fragment.fromHtml(p);var q=new CKEDITOR.htmlParser.basicWriter;p.writeHtml(q,this.dataFilter);return q.getHtml(!0)}};CKEDITOR.cleanWord=function(q,t){CKEDITOR.env.gecko&&(q=q.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));CKEDITOR.env.webkit&&(q=q.replace(/(class="MsoListParagraph[^>]+><\!--\[if !supportLists\]--\>)([^<]+<span[^<]+<\/span>)(<\!--\[endif\]--\>)/gi,"$1<span>$2</span>$3"));var p=new i,r=p.dataFilter;r.addRules(CKEDITOR.plugins.pastefromword.getRules(t,r));t.fire("beforeCleanWord",{filter:r});try{q=p.toHtml(q)}catch(s){alert(t.lang.pastefromword.error)}q=q.replace(/cke:.*?".*?"/g,"");q=q.replace(/style=""/g,"");return q.replace(/<span>/g,"")}})();